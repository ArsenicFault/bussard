-- This -*- lua -*- code runs inside your ship's own computer.

ship.controls = {
   up = ship.actions.forward,
   left = ship.actions.left,
   right = ship.actions.right,
   ["="] = function(d) if d then ship.scale = ship.scale - (ship.dt/2) end end,
   ["-"] = function(d) if d then ship.scale = ship.scale + (ship.dt/2) end end,
}

local pause = function() ship.paused = (not ship.paused) end

-- Flight mode
define_mode("flight")

bind("flight", "ctrl-return", lume.fn(ship.editor.change_buffer, "*console*"))

-- You can change this so escape by itself quits if you prefer.
bind("flight", "escape", ship.ui.splash)
bind("flight", "ctrl-q", ship.ui.quit)

-- ctrl-tab selects closest target; repeated ctrl-tab selects next-closest
local closest_cycle = 1
bind("flight", "ctrl-tab", function()
        ship.actions.closest_target(closest_cycle)
        closest_cycle = closest_cycle + 1
end)

-- regular tab selects next target in "order"; clears state of ctrl-tab cycling
bind("flight", "tab", function()
        closest_cycle = 1
        ship.actions.next_target()
end)

-- to open a file
bind("flight", "alt-o", function()
        ship:read_line("Open: ", lume.fn(ship.editor.open, ship))
end)

-- reload config
bind("flight", "ctrl-r",
     function()
        ship.dofile("src.config")
        ship.editor.initialize()
end)

-- connect over ssh
bind("flight", "ctrl-s", function()
        ship.editor.change_buffer("*console*")
        ssh()
end)

-- open mail client
bind("flight", "ctrl-m", function()
        ship.editor.change_buffer("*console*")
        mail()
end)

dofile("src.edit")
dofile("src.console")
dofile("src.hud")
dofile("src.ssh")
dofile("src.mail")

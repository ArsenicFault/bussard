-- Edit mode -*- lua -*-

dofile("src.edit_functions")

define_mode("edit")

-- most of the functions these are bound to should be self-explanatory
-- just by looking at the function name.

local exit = function()
   ship.editor.save()
   ship.editor.change_buffer(nil) -- nil buffer means flight mode
end

bind("edit", "escape", exit)
bind("edit", "ctrl-return", exit)

bind("edit", "ctrl-q", function()
        ship.editor.save()
        ship.ui.quit()
end)

-- cycle forwards and backwards through open buffers.
bind("edit", "ctrl-pageup", lume.fn(ship.editor.next_buffer, -1))
bind("edit", "ctrl-pagedown", ship.editor.next_buffer)

-- not all keyboards have these keys, but they're handy.
bind("edit", "appback", lume.fn(ship.editor.next_buffer, -1))
bind("edit", "appforward", ship.editor.next_buffer)

-- you can bind return to just ship.editor.newline to disable auto-indent.
bind("edit", "return", ship.editor.newline_and_indent)
bind("edit", "ctrl-z", ship.editor.undo)
bind("edit", "ctrl-s", ship.editor.save)
bind("edit", "alt-r", ship.editor.revert)

-- "Conventional" keys
bind("edit", "backspace", ship.editor.delete_backwards)
bind("edit", "delete", ship.editor.delete_forwards)

bind("edit", "home", ship.editor.beginning_of_line)
bind("edit", "end", ship.editor.end_of_line)
bind("edit", "left", ship.editor.backward_char)
bind("edit", "right", ship.editor.forward_char)
bind("edit", "up", ship.editor.prev_line)
bind("edit", "down", ship.editor.next_line)
bind("edit", "wheelup", ship.editor.prev_line)
bind("edit", "wheeldown", ship.editor.next_line)

bind("edit", "ctrl- ", ship.editor.mark)
bind("edit", "ctrl-space", ship.editor.mark)
bind("edit", "ctrl-c", ship.editor.kill_ring_save)
bind("edit", "ctrl-x", ship.editor.kill_region)
bind("edit", "ctrl-v", ship.editor.yank)

bind("edit", "alt-v", ship.editor.system_yank)
bind("edit", "alt-c", ship.editor.system_copy_region)

bind("edit", "pageup", ship.editor.scroll_up)
bind("edit", "pagedown", ship.editor.scroll_down)

bind("edit", "ctrl-home", ship.editor.beginning_of_buffer)
bind("edit", "ctrl-end", ship.editor.end_of_buffer)

bind("edit", "ctrl-w", ship.editor.close)

-- force close even if unsaved changes exist.
bind("edit", "ctrl-alt-w", function()
        ship.editor.close(true)
end)

-- Search
bind("edit", "ctrl-f", ship.editor.search)
bind("edit", "alt-r", ship.editor.replace)

bind("edit", "alt-g", function()
        ship.editor.read_line("Go to line: ", function(l, cancel)
                                 if(not cancel) then
                                    ship.editor.go_to(tonumber(l)) end end)
end)

dofile("src.lua")

-- uncomment this out to enable Emacs key bindings, which conflict with
-- some of the more conventional bindings.
-- dofile("src.emacs")

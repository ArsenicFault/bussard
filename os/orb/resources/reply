-- -*- lua -*-

local f, env, args = ...

if(args[1] == "--help" or #args ~= 1) then
   print("Reply to a message, indicating acceptance of a mission offered.\n")
   print("Usage:")
   print("  reply /usr/news/soc.example/some-message.msg")
else
   local message = f[orb.normalize(args[1], env.CWD)]
   if(not message) then
      print("Message not found.")
      return
   end
   local message_id = message:match("Message--Id: ([^\n]+)")
   if(not message_id) then
      print("Malformed message; missing Message-Id header.")
      return
   end
   local success, reason = accept_mission(message_id)
   if(success) then
      print("Accepted mission.")
   else
      print("Could not accept mission: " .. reason)
   end
end
